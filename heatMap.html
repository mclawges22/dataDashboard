<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>amMap example</title>
        
        <link rel="stylesheet" href="css/ammap.css" type="text/css">
	    <link rel="stylesheet" href="css/styles.css" type="text/css">
		<link rel="stylesheet" href="jquery-ui-1.9.2/themes/base/jquery-ui.css" type="text/css">
        <script src="js/ammap.js" type="text/javascript"></script>
        <!-- map file should be included after ammap.js -->
	<script src="js/worldLow.js" type="text/javascript"></script>
	<script src="jquery-ui-1.9.2/jquery-1.8.3.js" type="text/javascript"></script>
	<script src="jquery-ui-1.9.2/ui/jquery-ui.js" type="text/javascript"></script>
        <script type="text/javascript">
		var map;
		var values = [];
				
		AmCharts.ready(function() {
		    // let's generate the data for 50 slides
		    generateData();
		    
		    // let's build the map
		    map = new AmCharts.AmMap();
		    map.pathToImages = "http://www.ammap.com/lib/3/images/";
		    //map.panEventsEnabled = true; // this line enables pinch-zooming and dragging on touch devices
		    map.colorSteps = 20;
		    map.balloon.color = "#000000";
		    map.minValue = 0;
		    map.maxValue = 100;
		    var dataProvider = {
			mapVar: AmCharts.maps.worldLow,
			getAreasFromMap: true,
			images: [ // let's add one image to display the year of the current slide
			    {
				left: 10,
				top: 485,
				label: values[0].year,
				labelColor: "#054038",
				labelRollOverColor: "#CC0000",
				labelFontSize: 16
			    }
			],
			areas: values[0].areas // we'll use the data for the first slide here
		    };
		    
		    map.areasSettings = {
			autoZoom: false,
			color:"#054038",
			colorSolid:"#9EF0D2",
		    };
		    console.log(map.areasSettings);
		    map.dataProvider = dataProvider;
		
		    var valueLegend = new AmCharts.ValueLegend();
		    valueLegend.right = 10;
		    valueLegend.minValue = "0%";
		    valueLegend.maxValue = "100%";
		    valueLegend.showAsGradient= true;
		    map.valueLegend = valueLegend;
		    
		    // disable zoom controls
		    map.zoomControl.top=40;
		    //map.zoomControl.panControlEnabled = false;
		
		    map.write("mapdiv");
		});
		
		function generateData () {
		    for (var i = 0; i < 16; i++) {
			if (i==0) {
			    var row = {
				year:1990,
				areas: []
			    }
			}
			else if (i==1) {
			    var row = {
				year:1995,
				areas: []
			    }
			}
			else if (i==2) {
			    var row = {
				year:1998,
				areas: []
			    }
			}
			else {
			    var row = {
			    year: 2013 - 16 + i,
			    areas: []
			    }
			}
			for (var key in AmCharts.maps.worldLow.svg.g.path) {
			    if (AmCharts.maps.worldLow.svg.g.path[key].available == true) {
				var id = AmCharts.maps.worldLow.svg.g.path[key].id;
				console.log(id);
				var rate = AmCharts.maps.worldLow.svg.g.path[key].rates[i];
				//color?
				//if (rate < 10) {
				    //code	
				//}
				row.areas.push({
				    id: id,
				    value: rate
				});
				console.log(AmCharts.maps.worldLow.svg.g.path[key].rates[i]);
			    }
			    else {
				var id = AmCharts.maps.worldLow.svg.g.path[key].id;
				console.log(id);
				
				//color?
				//if (rate < 10) {
				    //code	
				//}
				row.areas.push({
				    id: id,
				    color: "#999"
				});
			    }
			}
			//console.log(row.areas);
			values.push(row);
		    }
		}
			
		function getRandom (prev) {
		    if (prev == undefined) {
			return Math.ceil(Math.random() * 100000);
		    }
		    else {
			return prev * (Math.random() - 0.5);
		    }
		}
		
		// initialize slider
		var currentSlide = 0;
		var playInterval;
		var slideDuration = 1000; // in milliseconds
		var autoRewind = true;
		$(function() {
		    $( "#slider" ).slider({
			value: 0,
			min: 0,
			max: 15,
			step: 1,
			slide: function( event, ui ) {
			    setSlide(ui.value);
			}
		    });
		    
		    $( "#play" ).button({
		      icons: {
			primary: "ui-icon-play"
		      },
		      text: false
		    }).click(function () {
			if (playInterval != undefined) {
			    clearInterval(playInterval);
			    playInterval = undefined;
			    $(this).button({
				icons: {
				    primary: "ui-icon-play"
				}
			    });
			    return;
			}
			$(this).button({
			    icons: {
				primary: "ui-icon-pause"
			    }
			});
			playInterval = setInterval(function () {
			    currentSlide++;
			    if (currentSlide > values.length) {
				if (autoRewind) {
				    currentSlide = 0;
				}
				else {
				    clearInterval(playInterval);
				    return;
				}
			    }
			    setSlide(currentSlide);
			}, slideDuration);
		    });
		});
		
		function setSlide (index) {
		    currentSlide = index;
		    map.dataProvider.areas = values[index].areas;
		    map.dataProvider.images[0].label = values[index].year;
		    map.validateData();
		    $( "#slider" ).slider( "value", index );
}
		</script>
    </head>
    
    <body>
	<h1>The Growth of the Internet</h1>
        <div id="mapdiv" style="width: 100%; background-color:#EEEEEE; height: 500px;"></div>
	<br>
	<button id="play">Play</button>
	<div id="slider" style="margin-left: 50px; margin-right: 10px;"></div>
    </body>

</html>